<!DOCTYPE html>
<html>
<head>
  <title>webGraphEd</title>

  <link rel="stylesheet" href="css/webGraphEd.css">

  <script type="text/javascript" src="external/d3/d3.v3.min.js"></script>
  <script type="text/javascript" src="external/jquery/jquery-2.1.0.min.js"></script>
  <script type="text/javascript" src="external/FileSaver/FileSaver.js"></script>
  
  <script type="text/javascript" src="lib/global.js"></script>
  <script type="text/javascript" src="lib/utils.js"></script>
  <!--script type="text/javascript" src="lib/classes.js"></script-->
  <script type="text/javascript" src="lib/dom_utils.js"></script>
  <script type="text/javascript" src="lib/file_utils.js"></script>
  <script type="text/javascript" src="lib/string_utils.js"></script>
  <!--script type="text/javascript" src="external/Blob/Blob.js"></script-->
  <script type="text/javascript" src="core/gml_file.js"></script>
  <script type="text/javascript" src="core/graphml_file.js"></script>
  <script type="text/javascript" src="core/json2.js"></script>
  <script type="text/javascript" src="core/graph_drawing.js"></script>
  <script type="text/javascript" src="core/tree.js"></script>
  <script type="text/javascript" src="layout/layout.js"></script>
  <script type="text/javascript" src="layout/force-directed.js"></script>
  <script type="text/javascript" src="layout/reingold-tilford-tree.js"></script>
  <script type="text/javascript" src="layout/collapsible-tree.js"></script>

  <script src="external/closure-library/closure/goog/base.js"></script>
  <script>
    goog.require('goog.array');
    goog.require('goog.events');
    goog.require('goog.events.EventType');
    goog.require('goog.debug.DivConsole');
    goog.require('goog.debug.Logger');
    goog.require('goog.debug.LogManager');
    goog.require('goog.object');
    goog.require('goog.ui.Menu');
    goog.require('goog.ui.MenuBarRenderer');
    goog.require('goog.ui.menuBarDecorator');
    goog.require('goog.ui.menuBar');
    goog.require('goog.ui.MenuButton');
    goog.require('goog.ui.MenuItem');
    goog.require('goog.ui.Separator');
    goog.require('goog.ui.decorate');
    goog.require('goog.ui.Dialog');	
  </script>
  <link rel="stylesheet" href="external/closure-library/closure/goog/demos/css/demo.css">
  <link rel="stylesheet" href="external/closure-library/closure/goog/css/menu.css">
  <link rel="stylesheet" href="external/closure-library/closure/goog/css/menubar.css">
  <link rel="stylesheet" href="external/closure-library/closure/goog/css/menubutton.css">
  <link rel="stylesheet" href="external/closure-library/closure/goog/css/menuitem.css">
  <link rel="stylesheet" href="external/closure-library/closure/goog/css/menuseparator.css">
  <link rel="stylesheet" href="external/closure-library/closure/goog/css/dialog.css">
</head>

<body>
 
<script LANGUAGE="JavaScript">
if (!checkBrowserCompatibility()) {
	alert('Some needed APIs are not fully supported in this browser.');
}

function performClick(node) {
	var evt = document.createEvent("MouseEvents");
	evt.initEvent("click", true, false);
	node.dispatchEvent(evt);
}
</script>


<div id="menuBar"></div>
<div id="main"></div>
<div id='fileDialog'>
    <input type="file" id="openFile" style="visibility:hidden" onchange='readFile(this)' />
</div>

<script type="text/javascript" src="ui/canvas.js"></script>
<script type="text/javascript" src="ui/dialogs.js"></script>
<script type="text/javascript" src="ui/menu.js"></script>

<script type="text/javascript">



</script>
<br>


<script>




// ----------------------------------------------------------------------------
//                               Initialization
// ----------------------------------------------------------------------------

createCanvas();	
layout = new Layout();


function loadGraphDrawing() {
	// Load file into layout object
	switch (format) {
		case 'GML':
			layout.importGML(graph);
			break;
		case 'GRAPHML':
			layout.importGraphML(graph);
			break;
		default:
			alert("Format not supported!"); 
			throw "Format not supported!";
			break;
	}
   
    // Layout the graph drawing
    switch (query.layout) {
        case 't':
            layout.layoutCollapsibleTree(canvas);
            break;
        case 'rt':
            layout.layoutReingoldTilfordTree(container);
            break;
        case 'fd':
            layout.layoutForceDirected(canvas);
            break;
        default:
            alert("Layout not supported!"); 
            throw "Layout not supported!";
            break;
    }
    updateMenu(layout.graph);
}

// Parameters:
// - layout=[t|rt|fd]
// - url|graph,format=[gml|graphml]
var query = getURLParameters();
var graph, format;
var bWait = true;
//console.log('query: ' + query);
//console.log('query.layout: ' + query.layout);

// Example 1: ?layout=t&format=gml&graph=graph%20[%0A%20%20comment%20"Binary%20tree"%0A%20%20node%20[%20id%201%20label%20"Node%201"%20]%0A%20%20node%20[%20id%202%20label%20"Node%202"%20]%0A%20%20node%20[%20id%203%20label%20"Node%203"%20]%0A%20%20node%20[%20id%204%20label%20"Node%204"%20]%0A%20%20node%20[%20id%205%20label%20"Node%205"%20]%0A%0A%20%20edge%20[%20source%201%20target%202%20]%0A%20%20edge%20[%20source%201%20target%203%20]%0A%20%20edge%20[%20source%202%20target%204%20]%0A%20%20edge%20[%20source%202%20target%205%20]%0A]
// graph [
//   comment "Binary tree"
//   node [ id 1 label "Node 1" ]
//   node [ id 2 label "Node 2" ]
//   node [ id 3 label "Node 3" ]
//   node [ id 4 label "Node 4" ]
//   node [ id 4 label "Node 5" ]
//
//   edge [ source 1 target 2 ]
//   edge [ source 1 target 3 ]
//   edge [ source 2 target 4 ]
//   edge [ source 2 target 5 ]
// ] 
// Example 2 ?layout=rt&url=http://xtec.cat/~jciberta/webGraphEd/binary-tree2.gml
if (query.layout != undefined) {

    // Get the graph drawing
    if (query.format != undefined && query.graph != undefined) {
console.log('format: ' + query.format.toUpperCase());    
console.log('graph: ' + decodeURIComponent(query.graph));    

		graph = decodeURIComponent(query.graph);
		format = query.format.toUpperCase();
		loadGraphDrawing();
    }
    else if (query.url != undefined) {
		var allText, lines;

		// NOTE: only work on the server side. DON'T try in local development, it doesn't work!
		// Adapted from http://social.msdn.microsoft.com/Forums/en-US/64ea2d16-7594-400b-8b25-8b3b9a078eab/read-external-text-file-with-javascript?forum=sidebargadfetdevelopment
		var txtFile = new XMLHttpRequest();
		txtFile.open("GET", query.url, true);
		txtFile.onreadystatechange = function() {
		  if (txtFile.readyState === 4) {  // Makes sure the document is ready to parse.
			if (txtFile.status === 200) {  // Makes sure it's found the file.
				graph = txtFile.responseText; 
				format = getFileExtension(query.url).toUpperCase();
console.log('graph: ' + graph);
console.log('format: ' + format);
				loadGraphDrawing();
			}
		  }
		}
		txtFile.send(null);    
   }

/*   while (!bWait);
   
console.log('graph: ' + graph);
console.log('format: ' + format);

	// Load file into layout object
	switch (format) {
		case 'GML':
			layout.importGML(graph);
			break;
		case 'GRAPHML':
			layout.importGraphML(graph);
			break;
		default:
			alert("Format not supported!"); 
			throw "Format not supported!";
			break;
	}
   
    // Layout the graph drawing
    switch (query.layout) {
        case 't':
            layout.layoutCollapsibleTree(canvas);
            break;
        case 'rt':
            layout.layoutReingoldTilfordTree(container);
            break;
        case 'fd':
            layout.layoutForceDirected(canvas);
            break;
        default:
            alert("Layout not supported!"); 
            throw "Layout not supported!";
            break;
    }
    updateMenu(layout.graph);*/
}

	
/*canvas = d3.select("#main").append("svg")
    .attr("width", WIDTH + margin.left + margin.right)
    .attr("height", HEIGHT + margin.top + margin.bottom)
	.attr("id", "canvas")
  .append("g")
    .attr("transform", "translate(" + margin.left + "," + margin.right + ")")
    .call(zoom);

container = vis.append("g");*/
    
 
    
/*var vis = d3.select("#main")
  .append("svg:svg")
  .attr("width", WIDTH)
  .attr("height", HEIGHT)
  .attr("id", "canvas")*/

/*frame = d3.select("svg")
  .append("svg:rect")
    .attr("width", "100%")
    .attr("height", "100%")
    .attr("stroke", "#000")
    .attr("stroke-width", 1)
    .attr("fill", "none");*/




</script>

<!--input type="button" value="Show Dialog" onclick="$('#openFile').click();" />
<INPUT TYPE="button" VALUE="Import" onClick="importFile()">
<INPUT TYPE="button" VALUE="Properties" onClick="showProperties()"-->


</body>
</html>
